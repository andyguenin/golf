<h1 class="no-bottom"><%= @tournament.name %></h1>
<h2 class="lighten"><em><%= @tournament.course.location %></em></h2>
<% if params[:bucketing_data]%>
ABCDEFG
<% end%>
<div class="pull-right btn-group">
	<%= link_to "Edit Tournament", edit_tournament_path(@tournament), :class => "btn btn-warning"%>
</div><br /><br />
<table class="table table-condensed" style="border-collapse:collapse;">
    <tbody>
		<% holes = @tournament.course.holes.order("hole_number asc")%>

        <% counter = 1 %>
        <% (@tournament.players.includes(:scores).where("tournament_id = ?", @tournament.id).all.sort_by {|t| [t.get_tplayer(@tournament).status, t.score_by_tournament(@tournament), t.scores.length, t.last_name] }).each do |p| %>
        <tr data-toggle="collapse" data-target="#demo<%= counter %>" class="accordion-toggle">
          <td>

						<%= p.name %>
					</td>
					<td>
						<% tplayer = p.get_tplayer(@tournament)%>
						<%= tplayer.status == 0 ? tplayer.score : "CUT"%>
  
      <tr >
            <td colspan="20" class="hiddenRow"><div class="accordian-body collapse" id="demo<%= counter %>">

              <% tscores = p.scores_by_tournament(@tournament) %>

              <table class="table table-condensed table-bordered score-table">
                <thead>
                  <% 2.times do |s| %>
                  <tr><th><%= s==0 ? "Hole" : "Par" %></th>
                    <% @tournament.course.holes.order("hole_number asc").each do |h| %>
                    <td><strong><%= h.send("#{s==0 ? "hole_number" : "par"}") %></strong></td>
                    <% end %>  
                    <th><%= s==0 ? "Total" : @tournament.course.holes.map{|h| h.par}.sum %></th>
                  </tr>
                  <% end %>
                </thead>
                <tbody>
                  <% 4.times do |round| %>
                  <tr><td><%= round+1 %></td>
                    <% (1..18).each do |hole|%>
                      <td><%= tscores[round][hole-1].nil? ? "-" : tscores[round][hole-1].strokes%></td>
                    <% end %>
                    <td><%= tscores[round].empty? ? "" :  (tscores[round].count == 18 ? tscores[round].map{|t| t.strokes}.sum : p.score_by_tournament_round(@tournament, round+1))%></td>
                  </tr>
                  <% end %>
                </tbody>
              </table>

           </div> </td>
        </tr>
      <% counter = counter + 1 %>  
      <% end %>
    </tbody>
</table>
